---
title: "Crystallography"
author: "Joanna So³omiewicz"
date: "15 listopada 2018"
output: 
  html_document: 
    theme: spacelab
    toc: yes
    toc_float: yes
---

#Loading libraries
```{r loading libraries, message = FALSE}
library(dplyr)
library(ggplot2)
library(plotly)
library(tidyr)
```

#Reading data
```{r reading data, cache = TRUE}
data <- read.csv2('./all_summary.csv', nrows = 10000)
dim(data)
```

#Processing missing data
```{r processing missing data, cache = TRUE}
required_columns <- c("res_name", "blob_volume_coverage", "blob_volume_coverage_second", "skeleton_density", "local_res_atom_non_h_count", "local_res_atom_non_h_electron_sum")
dim(data)
data <- data %>% 
  select(one_of(required_columns)) %>%
  drop_na()
dim(data)
```

#Deleting chosen ligands
```{r deleting chosen ligands}
deletable_res_name <- c("UNK", "UNX", "UNL", "DUM", "N", "BLOB", "ALA", "ARG", "ASN", "ASP", "CYS", "GLN", "GLU", "GLY", "HIS", "ILE", "LEU", "LYS", "MET", "MSE", "PHE", "PRO", "SEC", "SER", "THR", "TRP", "TYR", "VAL", "DA", "DG", "DT", "DC", "DU", "A", "G", "T", "C", "U", "HOH", "H20", "WAT")
data <- data %>% filter(!res_name %in% deletable_res_name)
dim(data)
```

#Data summary
```{r data summary}
statistics <- data %>%
  select(res_name, blob_volume_coverage, blob_volume_coverage_second, skeleton_density)
knitr::kable(summary(statistics))
dim(data)
```

#50 most popular ligands
```{r 50 most popular ligands}
popular_ligands <- data %>% 
  select(res_name) %>%
  count(res_name, sort = TRUE) %>%
  slice(1:50)

popular_names_vector <- popular_ligands %>%
  pull(res_name)

data <- data %>% filter(res_name %in% popular_names_vector)
dim(data)
```

#Cardinality of ligands by name
```{r cardinality of ligands}
plot_ligands <- ggplot(popular_ligands, aes(x = reorder(res_name, -n), y = n, fill = n)) +
  geom_bar(stat = "identity") +
  theme(axis.text.x = element_text(angle = 90)) +
  xlab("ligand")+
  labs(title = "Cardinality of ligands by name")

ggplotly(plot_ligands)
```

#Distribution of atom and electron count
```{r distribution of atom and electron count}
plot_atom <- ggplot(data, aes(x = local_res_atom_non_h_count)) + 
  geom_density(alpha = .3, fill = "#00CECB", color = NA) +
  xlab("atom count") +
  labs(title = "Atom count distribution")

ggplotly(plot_atom)

plot_electron <- ggplot(data, aes(x = local_res_atom_non_h_electron_sum)) + 
  geom_density(alpha = .3, fill = "#FF5E5B", color = NA) +
  xlab("electron count") +
  labs(title = "Electron count distribution")

ggplotly(plot_electron)
```